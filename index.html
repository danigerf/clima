<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <title>Metar/TAF Brasil</title>
    <style>
      body {
        max-width: 38rem;
        padding: 2rem;
        margin: auto;
        font-family: Arial, Helvetica, sans-serif;
      }
      label {
        display: block;
      }
      form {
        text-align: center;
        margin: auto;
        padding: 10px;
      }
      button {
        background-color: black;
        color: white;
        border-radius: 5px;
        text-transform: uppercase;
        border: 1px solid black;
        overflow: hidden;
        padding: 3px 10px;
        font-size: 15px;
      }
      input {
        background-color: white;
        border-radius: 5px;
        text-transform: uppercase;
        border: 1px solid black;
        overflow: hidden;
        padding: 1px 10px;
        font-size: 15px;
        margin-top: 10px;
        height: 20px;
      }
      h1 {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1>Metar e TAF</h1>
    <form id="form">
      <label> Digite a localidade </label>
      <input
        type="text"
        name="localidade"
        id="localidade"
        placeholder="Ex. SBSP"
      />

      <button type="submit">Enviar</button>
    </form>

    <div id="mensagem">
      <br />
      <div id="metar"></div>
      <br />
      <div id="taf"></div>
    </div>
    <script>
      const form = document.getElementById("form");
      form.addEventListener("submit", localidade);

      async function localidade() {
        event.preventDefault();
        const localidade = document.getElementById("localidade").value;
        document.getElementById("localidade").value = document
          .getElementById("localidade")
          .value.toUpperCase();
        document.getElementById("metar").textContent = "";
        document.getElementById("taf").textContent = "";
        const request = new Request(
          "https://api-redemet.decea.mil.br/mensagens/metar/" +
            localidade +
            "?api_key=P7nbl2BS8mUe8tAQ95FZSHQzBsA9InoFPkAqBmun"
        );

        const response = await fetch(request);
        const metar = await response.json();
        if (metar.data.data[0]) {
          document.getElementById("metar").textContent =
            metar.data.data[0].mens;
          document.title = localidade.toUpperCase() + " Metar|TAF";

          const requestTaf = new Request(
            "https://api-redemet.decea.mil.br/mensagens/taf/" +
              localidade +
              "?api_key=P7nbl2BS8mUe8tAQ95FZSHQzBsA9InoFPkAqBmun"
          );

          const responseTaf = await fetch(requestTaf);
          const taf = await responseTaf.json();
          tafFunc(taf.data.data[0].mens);
        } else {
          document.getElementById("mensagem").textContent =
            "ICAO n√£o encontrado";
        }
      }

      function tafFunc(mensagem) {
        mensagem = mensagem.replaceAll("BECMG", "<br> BECMG");
        mensagem = mensagem.replaceAll("TEMPO", "<br> TEMPO");
        mensagem = mensagem.replaceAll("PROB", "<br> PROB");

        document.getElementById("taf").innerHTML = mensagem;
      }
    </script>
  </body>
</html>
